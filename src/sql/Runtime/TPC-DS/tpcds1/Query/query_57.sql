select * from (select  * from (select i_manufact_id,sum(ss_sales_price) sum_sales,avg(sum(ss_sales_price)) over (partition by i_manufact_id) avg_quarterly_salesfrom item, store_sales, date_dim, storewhere ss_item_sk = i_item_sk andss_sold_date_sk = d_date_sk andss_store_sk = s_store_sk andd_month_seq in (1186,1186+1,1186+2,1186+3,1186+4,1186+5,1186+6,1186+7,1186+8,1186+9,1186+10,1186+11) and((i_category in ('Books','Children','Electronics') andi_class in ('personal','portable','reference','self-help') andi_brand in ('scholaramalgamalg #14','scholaramalgamalg #7',		'exportiunivamalg #9','scholaramalgamalg #9'))or(i_category in ('Women','Music','Men') andi_class in ('accessories','classical','fragrances','pants') andi_brand in ('amalgimporto #1','edu packscholar #1','exportiimporto #1',		'importoamalg #1')))group by i_manufact_id, d_qoy ) tmp1where case when avg_quarterly_sales > 0 	then abs (sum_sales - avg_quarterly_sales)/ avg_quarterly_sales 	else null end > 0.1order by avg_quarterly_sales,	 sum_sales,	 i_manufact_id ) where rownum <= 100;